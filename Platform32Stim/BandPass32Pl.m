%带通滤波器
%
%  * 离散时间 IIR 滤波器(实数)
%  * ----------------
%  * 滤波器结构  : 直接 II 型，二阶节
%  * 节数     : 16
%  * 稳定     : 是
%  * 线性相位   : 否
%  * 采样率：500kHz
%  * 上限频率：800Hz
%  * 下限频率：52000Hz
%

%定义滤波器分子和分母系数
NUM = {
    [0.3072737913767, 0, 0],
    [1, 0, -1],
    [0.3072737913767, 0, 0],
    [1, 0, -1],
    [0.2917908848507, 0, 0],
    [1, 0, -1],
    [0.2917908848507, 0, 0],
    [1, 0, -1],
    [0.2791602606397, 0, 0],
    [1, 0, -1],
    [0.2791602606397, 0, 0],
    [1, 0, -1],
    [0.269092481685, 0, 0],
    [1, 0, -1],
    [0.269092481685, 0, 0],
    [1, 0, -1],
    [0.2613368070818, 0, 0],
    [1, 0, -1],
    [0.2613368070818, 0, 0],
    [1, 0, -1],
    [0.2556923981319, 0, 0],
    [1, 0, -1],
    [0.2556923981319, 0, 0],
    [1, 0, -1],
    [0.2520105917582, 0, 0],
    [1, 0, -1],
    [0.2520105917582, 0, 0],
    [1, 0, -1],
    [0.2501938060926, 0, 0],
    [1, 0, -1],
    [0.2501938060926, 0, 0],
    [1, 0, -1],
    [1, 0, 0]
    };

DEN =  {
    [1, 0, 0],
    [1, -1.501329946829, 0.8906300626122],
    [1, 0, 0],
    [1, -1.997986686541, 0.9980877081146],
    [1, 0, 0],
    [1, -1.357137506508, 0.7073796041721],
    [1, 0, 0],
    [1, -1.994222538487, 0.9943237949428],
    [1, 0, 0],
    [1, -1.990625053109, 0.9907269301671],
    [1, 0, 0],
    [1, -1.245699496436, 0.5643234472532],
    [1, 0, 0],
    [1, -1.98730738933, 0.987410183609],
    [1, 0, 0],
    [1, -1.160968533039, 0.454383191267],
    [1, 0, 0],
    [1, -1.98439724671, 0.9845011192726],
    [1, 0, 0],
    [1, -1.098255811634, 0.3721280054537],
    [1, 0, 0],
    [1, -1.98203441049, 0.9821393474875],
    [1, 0, 0],
    [1, -1.054066293289, 0.3135766073357],
    [1, 0, 0],
    [1, -1.980358517962, 0.9804643129169],
    [1, 0, 0],
    [1, -1.025924167939, 0.275970365794],
    [1, 0, 0],
    [1, -1.979486636763, 0.9795929119465],
    [1, 0, 0],
    [1, -1.012241716021, 0.2575820023403],
    [1, 0, 0]};
   
    
%定义滤波器阶数
Nsec = 33;

% 创建一个滤波器对象
fs = 500e3;  % 假设采样频率为500e3Hz

N = 1024;
%创建一个包含1hz，50hz，1000hz，2000hz，5000hz，10khz的信号
f = [50,1e3,100e3,200e3];
t = 0:1/fs:(N-1)/fs;  % 1秒的时间向量
signal = 0.2*sin(f(1)*2*pi*t)+sin(2*pi*t*f(2))+...
    1*sin(f(3)*2*pi*t)+0.5*sin(f(4)*2*pi*t);

% 计算频谱
signal_fft = abs(fft(signal));
freq = (0:N-1)*fs/N;  % 频率轴

% 应用滤波器进行处理
filtered_signal = signal;
for i = 1:Nsec
    filtered_signal = filter(NUM{i}, DEN{i}, filtered_signal);
end

%滤波后信号的频谱
filtered_signal_fft = abs(fft(filtered_signal));

% 可视化信号和频谱
figure;

% 时域信号图
subplot(2, 2, 1);
plot(t, signal);
title('Original Signal');
xlabel('Time (s)');
ylabel('Amplitude');

subplot(2, 2, 2);
plot(t, filtered_signal);
title('Filtered Signal');
xlabel('Time (s)');
ylabel('Amplitude');

% 频域图
subplot(2, 2, 3);
plot(freq, signal_fft);
title('Original Signal Spectrum');
xlabel('Frequency (Hz)');
ylabel('Magnitude');
xlim([0 250e3]);  % 限制x轴范围，便于观察低频到高频的成分

subplot(2, 2, 4);
plot(freq, filtered_signal_fft);
title('Filtered Signal Spectrum');
xlabel('Frequency (Hz)');
ylabel('Magnitude');
xlim([0 25000]);  % 限制x轴范围，便于观察低频到高频的成分
